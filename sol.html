<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sol Editor — .sol file editor</title>
  <style>
    :root{
      --bg:#0f1720;
      --panel:#0b1220;
      --muted:#9aa7b2;
      --accent:#7dd3fc;
      --gutter:#07101a;
      --editor-bg:#0b1220;
      --font: "Courier New", ui-monospace, SFMono-Regular, Menlo, monospace;
    }
    html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial; background:linear-gradient(180deg,#071021 0%, #06101a 100%); color:#dbeafe}
    .wrap{max-width:1100px;margin:24px auto;padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02)); box-shadow:0 6px 30px rgba(2,6,23,0.6)}
    header{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    h1{font-size:18px;margin:0;color:var(--accent)}
    .controls{margin-left:auto;display:flex;gap:8px}
    button{background:#0b1520;color:#dbeafe;border:1px solid rgba(125,211,252,0.08); padding:8px 10px;border-radius:8px;cursor:pointer;font-weight:600}
    button.ghost{background:transparent;border:1px dashed rgba(125,211,252,0.06); color:var(--muted);font-weight:500}
    button.small{padding:6px 8px;font-size:13px}
    .meta{margin-top:12px;color:var(--muted);display:flex;gap:12px;flex-wrap:wrap}
    main{margin-top:16px;display:flex;gap:12px}
    /* editor container */
    .editor-wrap{flex:1; height:68vh; display:flex;border-radius:8px;overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
    .gutter{
      background:var(--gutter);
      color:var(--muted);
      width:56px;padding:10px 6px 10px 10px;
      box-sizing:border-box;
      font-family:var(--font);
      font-size:13px;line-height:20px;
      overflow:hidden;
      text-align:right;
      user-select:none;
    }
    .editor{
      flex:1; background:var(--editor-bg); padding:8px;height:100%;
    }
    textarea{
      width:100%;height:100%;resize:none;border:0;background:transparent;color:#e6f3ff;font-family:var(--font);font-size:13.5px;line-height:20px;padding:12px 12px 12px 12px;box-sizing:border-box;outline:none;
      white-space:pre; tab-size:2;
    }
    .sidebar{width:240px; background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent); border-left:1px solid rgba(255,255,255,0.02);padding:12px;border-radius:0}
    .drop-hint{border:2px dashed rgba(125,211,252,0.06);padding:8px;border-radius:6px;color:var(--muted);text-align:center;margin-top:10px}
    label.switch{display:flex;align-items:center;gap:8px;margin-top:10px}
    input[type="checkbox"]{accent-color:#7dd3fc}
    .small-muted{font-size:13px;color:var(--muted);margin-top:8px}
    .search-row{display:flex;gap:8px;margin-top:8px}
    input[type="text"]{padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:#dbeafe;flex:1}
    footer{margin-top:12px;color:var(--muted);font-size:13px;display:flex;justify-content:space-between;align-items:center}
    a.link{color:var(--accent);text-decoration:none}
    /* responsive */
    @media (max-width:880px){
      .sidebar{display:none}
      .controls{width:100%;margin-left:0;justify-content:flex-end}
      .editor-wrap{height:60vh}
    }
  </style>
</head>
<body>
  <div class="wrap" role="application">
    <header>
      <div>
        <h1>.sol Editor — open • edit • export</h1>
        <div class="meta" id="fileMeta">No file loaded</div>
      </div>

      <div class="controls" aria-hidden="false">
        <input id="fileInput" type="file" accept=".sol,text/plain" style="display:none" />
        <button id="openBtn">Open .sol</button>
        <button id="newBtn" class="ghost small">New</button>
        <button id="downloadBtn" class="small">Download</button>
        <button id="copyBtn" class="ghost small">Copy</button>
      </div>
    </header>

    <main>
      <div class="editor-wrap" id="dropZone">
        <div class="gutter" id="gutter">1</div>
        <div class="editor">
          <textarea id="editor" spellcheck="false" placeholder="// Drop a .sol file here or click Open."></textarea>
        </div>
      </div>

      <aside class="sidebar" aria-label="Tools">
        <div class="small-muted">Drag & drop a file onto the editor or click Open.</div>

        <div class="drop-hint" id="dropHint">Drop file anywhere in the editor</div>

        <label class="switch">
          <input type="checkbox" id="wrapToggle" />
          <span>Toggle word wrap</span>
        </label>

        <div class="search-row">
          <input type="text" id="findInput" placeholder="Find (press Enter)" />
          <button id="findNext" class="small">Next</button>
        </div>

        <div style="margin-top:10px">
          <button id="replaceBtn" class="ghost small">Replace</button>
          <button id="clearBtn" class="small ghost">Clear</button>
        </div>

        <div class="small-muted" style="margin-top:14px">Keyboard shortcuts:</div>
        <ul class="small-muted">
          <li>Ctrl/Cmd + S → Download</li>
          <li>Ctrl/Cmd + F → Focus Find</li>
          <li>Ctrl/Cmd + A → Select all</li>
        </ul>

        <div style="margin-top:12px;font-size:13px;color:var(--muted)">
          Tip: If you want full language aware editing later, open this file in VS Code or an online IDE.
        </div>
      </aside>
    </main>

    <footer>
      <div class="small-muted">Simple in-browser .sol editor — no server, local only.</div>
      <div><a class="link" href="#" id="helpLink">How to use</a></div>
    </footer>
  </div>

<script>
(function(){
  const fileInput = document.getElementById('fileInput');
  const openBtn = document.getElementById('openBtn');
  const newBtn = document.getElementById('newBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const copyBtn = document.getElementById('copyBtn');
  const editor = document.getElementById('editor');
  const gutter = document.getElementById('gutter');
  const dropZone = document.getElementById('dropZone');
  const dropHint = document.getElementById('dropHint');
  const wrapToggle = document.getElementById('wrapToggle');
  const fileMeta = document.getElementById('fileMeta');
  const findInput = document.getElementById('findInput');
  const findNext = document.getElementById('findNext');
  const replaceBtn = document.getElementById('replaceBtn');
  const clearBtn = document.getElementById('clearBtn');
  const helpLink = document.getElementById('helpLink');

  let currentFile = { name: null, lastModified: null, size: 0 };

  // helper: update gutter line numbers
  function updateGutter(){
    const lines = (editor.value.match(/\n/g) || []).length + 1;
    let nums = '';
    for(let i=1;i<=lines;i++){
      nums += i + '\n';
    }
    gutter.textContent = nums.trim();
  }

  // sync scroll
  editor.addEventListener('scroll', () => {
    gutter.scrollTop = editor.scrollTop;
  });

  editor.addEventListener('input', () => {
    updateGutter();
  });

  // initial gutter
  updateGutter();

  // open button
  openBtn.addEventListener('click', ()=> fileInput.click());
  fileInput.addEventListener('change', (e)=>{
    const f = e.target.files[0];
    if(f) readFile(f);
    fileInput.value = ''; // reset
  });

  // drag/drop
  ['dragenter','dragover'].forEach(ev => {
    dropZone.addEventListener(ev, (e)=>{ e.preventDefault(); dropHint.style.borderColor = 'rgba(125,211,252,0.25)'; });
  });
  ['dragleave','drop'].forEach(ev => {
    dropZone.addEventListener(ev, (e)=>{ e.preventDefault(); dropHint.style.borderColor = ''; });
  });
  dropZone.addEventListener('drop', (e)=>{
    const f = e.dataTransfer.files && e.dataTransfer.files[0];
    if(f) readFile(f);
  });

  // read file
  function readFile(file){
    const reader = new FileReader();
    reader.onload = (ev) => {
      const text = ev.target.result;
      editor.value = String(text);
      currentFile.name = file.name;
      currentFile.size = file.size;
      currentFile.lastModified = file.lastModified;
      updateFileMeta();
      updateGutter();
      editor.focus();
    };
    // only read as text
    reader.onerror = (err) => alert('Failed to read file: ' + err);
    reader.readAsText(file);
  }

  function updateFileMeta(){
    if(!currentFile.name){
      fileMeta.textContent = 'No file loaded';
      return;
    }
    const date = currentFile.lastModified ? new Date(currentFile.lastModified).toLocaleString() : 'n/a';
    fileMeta.innerHTML = `<strong>${escapeHtml(currentFile.name)}</strong> — ${Math.round(currentFile.size/1024)} KB — last modified ${date}`;
  }

  // download/export
  function downloadCurrent(){
    let filename = currentFile.name || 'untitled.sol';
    if(!filename.toLowerCase().endsWith('.sol')) filename = filename + '.sol';
    const blob = new Blob([editor.value], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  }

  downloadBtn.addEventListener('click', downloadCurrent);

  // new file
  newBtn.addEventListener('click', ()=> {
    if(editor.value && !confirm('Clear current editor? Unsaved changes will be lost.')) return;
    editor.value = '';
    currentFile = { name: null, lastModified: null, size:0 };
    updateFileMeta();
    updateGutter();
    editor.focus();
  });

  // copy to clipboard
  copyBtn.addEventListener('click', async ()=>{
    try{
      await navigator.clipboard.writeText(editor.value);
      copyBtn.textContent = 'Copied';
      setTimeout(()=> copyBtn.textContent = 'Copy', 1200);
    }catch(e){
      alert('Copy failed: ' + e);
    }
  });

  // find simple
  function findNextMatch(){
    const q = findInput.value;
    if(!q) return;
    const start = editor.selectionEnd || 0;
    const idx = editor.value.indexOf(q, start);
    if(idx === -1){
      // wrap
      const idx2 = editor.value.indexOf(q, 0);
      if(idx2 === -1){ alert('Not found'); return; }
      selectRange(idx2, idx2 + q.length);
    }else{
      selectRange(idx, idx + q.length);
    }
    editor.focus();
  }
  function selectRange(s,e){
    editor.setSelectionRange(s,e);
    // scroll into view
    const lineHeight = parseFloat(getComputedStyle(editor).lineHeight) || 20;
    const approxTop = (editor.value.slice(0,s).split('\n').length - 1) * lineHeight;
    editor.scrollTop = approxTop - 40;
  }
  findNext.addEventListener('click', findNextMatch);
  findInput.addEventListener('keydown', (ev) => {
    if(ev.key === 'Enter'){ ev.preventDefault(); findNextMatch(); }
  });

  // replace (simple)
  replaceBtn.addEventListener('click', ()=>{
    const q = findInput.value;
    const replacement = prompt('Replace with:', '');
    if(q === null || q === '') return alert('Enter a search term first.');
    if(replacement === null) return;
    editor.value = editor.value.split(q).join(replacement);
    updateGutter();
  });

  clearBtn.addEventListener('click', ()=>{
    if(!confirm('Clear editor content?')) return;
    editor.value = '';
    updateGutter();
  });

  // wrap toggle
  wrapToggle.addEventListener('change', (e)=>{
    editor.style.whiteSpace = e.target.checked ? 'pre-wrap' : 'pre';
  });

  // keyboard shortcuts
  window.addEventListener('keydown', (e) => {
    const cmd = e.ctrlKey || e.metaKey;
    if(cmd && e.key.toLowerCase() === 's'){
      e.preventDefault();
      downloadCurrent();
    } else if(cmd && e.key.toLowerCase() === 'f'){
      e.preventDefault();
      findInput.focus();
    }
  });

  // basic helper: escape HTML for display in meta
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]); }); }

  // small help popup
  helpLink.addEventListener('click', (e)=>{
    e.preventDefault();
    alert(
`How to use:
• Open: click Open .sol or drag + drop a .sol file into the editor.
• Edit: edit in the middle pane (works like a basic text editor).
• Download: click Download or press Ctrl/Cmd+S to save the file (original filename preserved where possible).
• Find/Replace: use the find box; Replace replaces all occurrences.

Notes:
• This editor runs fully in your browser. Files never leave your machine.
• For full Solidity language features (autocomplete, compilation), open the file in an IDE like VS Code with the Solidity extension.`
    );
  });

  // init: hint text for drag/drop
  dropZone.addEventListener('dragenter', ()=> dropHint.style.opacity = 1);
  dropZone.addEventListener('dragleave', ()=> dropHint.style.opacity = 1);

  // ensure gutter updates on paste and other actions
  ['paste','cut','keydown','keyup'].forEach(evt => editor.addEventListener(evt, () => setTimeout(updateGutter, 1)));

  // accessibility: if user loads a file by right-click > open with browser, we can pre-populate by asking to drop
  // nothing else

})();
</script>
</body>
</html>
